

node("ansible"){
  stage("STAGE 0 - Setting environment"){
    //git branch: 'master', url: 'https://github.com/okynos/wazuh-cicd.git'
    sh "mkdir tmp"
    sh "python tools/generateJSON.py deployments/structure.json deployments/default/deploy.json > tmp/standard_deploy.json"
    sh "python tools/generateInventory.py deploy tmp/standarddeploy.json > tmp/hosts_deploy"
    sh "python tools/generateInventory.py config tmp/standarddeploy.json > tmp/hosts_config"
  }

  stage("STAGE 1 - Deploy"){
    sh "ansible-playbook -i tmp/hosts_deploy deployments/default/deploy.yaml"
    sh "ansible-playbook -i tmp/hosts_config common-provision/conf-wazuh.yaml"
  }

  stage("STAGE X - Destroy"){
    //sh "ansible-playbook -i tmp/hosts_deploy deployments/default/destroy.yaml"
  }

}
